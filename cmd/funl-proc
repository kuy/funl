#!/usr/bin/env bash

shift
if [[ 0 -eq $# ]]; then
  exit 1
fi

idx=0
params=
for param in "$@"; do
  name=$(echo "$param" | sed -e 's/^[^{]*{\([^}][^}]*\)}[^}]*$/\1/')

  if [[ $name == $param ]]; then
    params[$idx]="$param"
  else
    choice=$(funl select $name)

    if [[ 0 -ne $? ]]; then
      echo "funl: not selected, abort" >&2
      exit 1
    fi

    script="s;{$name};$choice;g"
    params[$idx]=$(echo "$param" | sed "$script")
  fi

  ((idx++))
done

set -- "${params[@]}"

exec funl exec "$@"
